{% extends "base.html" %}

{% block title %}Website Customization{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-palette"></i> Website Customization</h3>
                <small class="text-muted">Personalize your website appearance</small>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    {{ form.hidden_tag() }}

                    <div class="mb-3">
                        {{ form.theme.label(class="form-label") }}
                        {{ form.theme(class="form-select") }}
                        <small class="form-text text-muted">Choose a theme for your website</small>
                    </div>

                    <div class="mb-3">
                        {{ form.background_image_file.label(class="form-label") }}
                        {{ form.background_image_file(class="form-control") }}
                        <small class="form-text text-muted">Upload a background image (JPG, PNG, GIF)</small>
                        {% if preferences.background_image %}
                        <div class="mt-2">
                            <small class="text-muted">Current background:</small><br>
                            <img src="{{ preferences.background_image }}" alt="Current background" style="max-width: 200px; max-height: 100px;" class="border">
                        </div>
                        {% endif %}
                    </div>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="mb-3">
                                {{ form.background_color.label(class="form-label") }}
                                {{ form.background_color(class="form-control", type="color") }}
                                <small class="form-text text-muted">Background color</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                {{ form.navbar_color.label(class="form-label") }}
                                {{ form.navbar_color(class="form-control", type="color") }}
                                <small class="form-text text-muted">Navigation bar color</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                {{ form.nav_link_color.label(class="form-label") }}
                                {{ form.nav_link_color(class="form-control", type="color") }}
                                <small class="form-text text-muted">Navigation link color</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                {{ form.accent_color.label(class="form-label") }}
                                {{ form.accent_color(class="form-control", type="color") }}
                                <small class="form-text text-muted">Accent color</small>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ form.custom_css.label(class="form-label") }}
                        {{ form.custom_css(class="form-control", rows=5, placeholder=".custom-class { color: red; }") }}
                        <small class="form-text text-muted">Advanced: Add custom CSS for your website</small>
                    </div>

                    <div class="d-grid">
                        {{ form.submit(class="btn btn-primary") }}
                    </div>
                </form>

                <hr>
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> Preview</h6>
                    <p>Your customization settings will be applied when you refresh the page or navigate to other pages.</p>
                    <button class="btn btn-sm btn-outline-primary" onclick="location.reload()">Refresh to Apply Changes</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Apply theme changes in real-time
document.addEventListener('DOMContentLoaded', function() {
    const themeSelect = document.querySelector('select[name="theme"]');
    const bgColorInput = document.querySelector('input[name="background_color"]');
    const navbarColorInput = document.querySelector('input[name="navbar_color"]');
    const navLinkColorInput = document.querySelector('input[name="nav_link_color"]');

    function applyTheme() {
        const theme = themeSelect.value;
        const bgColor = bgColorInput.value;
        const navbarColor = navbarColorInput.value;
        const navLinkColor = navLinkColorInput.value;

        if (theme === 'dark') {
            document.body.style.backgroundColor = '#1a1a1a';
            document.body.style.color = '#ffffff';
            document.querySelector('.navbar').style.backgroundColor = '#2d2d2d';
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.style.color = '#ffffff';
            });
        } else if (theme === 'custom') {
            document.body.style.backgroundColor = bgColor;
            document.querySelector('.navbar').style.backgroundColor = navbarColor;
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.style.color = navLinkColor;
            });
        } else {
            document.body.style.backgroundColor = '#ffffff';
            document.body.style.color = '#000000';
            document.querySelector('.navbar').style.backgroundColor = '';
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.style.color = '';
            });
        }
    }

    themeSelect.addEventListener('change', applyTheme);
    bgColorInput.addEventListener('input', applyTheme);
    navbarColorInput.addEventListener('input', function() {
        document.querySelector('.navbar').style.backgroundColor = this.value;
    });
    navLinkColorInput.addEventListener('input', function() {
        document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
            link.style.color = this.value;
        });
    });

    // Apply current settings
    applyTheme();
});
</script>
{% endblock %}
